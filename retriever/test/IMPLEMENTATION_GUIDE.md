# ğŸ¯ æ¨¡å—äºŒï¼šRetriever è¯¦ç»†å®æ–½æŒ‡å—

## ğŸ“‹ ä»»åŠ¡ç›®æ ‡
æ„å»ºä¸€ä¸ªè¯­ä¹‰æ£€ç´¢ç³»ç»Ÿï¼Œç»™å®šç”¨æˆ·æŸ¥è¯¢(query)ï¼Œèƒ½å¤Ÿä»çŸ¥è¯†åº“ä¸­æ£€ç´¢å‡ºkä¸ªæœ€ç›¸å…³çš„é—®ç­”å¯¹ã€‚

## ğŸ—ï¸ å®æ–½æ­¥éª¤è¯¦è§£

### ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒå‡†å¤‡å’Œæµ‹è¯• (30åˆ†é’Ÿ)

#### æ­¥éª¤1ï¼šæ£€æŸ¥Pythonç¯å¢ƒ
```bash
# ç¡®ä¿åœ¨é¡¹ç›®ç›®å½•ä¸‹
cd "c:\Users\14284\Desktop\CSSA\CSSA-DA"

# æ¿€æ´»condaç¯å¢ƒ
conda activate cssa-ai

# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version
```

#### æ­¥éª¤2ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬
```bash
# è¿è¡ŒRetrieveræµ‹è¯•
python retriever/test_retriever.py
```

#### æ­¥éª¤3ï¼šå®‰è£…å¿…è¦çš„åŒ…
```bash
# å®‰è£…jiebaåˆ†è¯åº“
pip install jieba

# å¦‚æœéœ€è¦æ›´é«˜ç²¾åº¦ï¼Œå®‰è£…sentence-transformersï¼ˆå¯é€‰ï¼‰
pip install sentence-transformers
```

### ç¬¬äºŒé˜¶æ®µï¼šå®ç°åŸºç¡€ç‰ˆæ£€ç´¢å™¨ (1å°æ—¶)

#### æ­¥éª¤4ï¼šè¿è¡Œç®€åŒ–ç‰ˆæ£€ç´¢å™¨
```bash
# è¿è¡ŒTF-IDFç‰ˆæœ¬çš„æ£€ç´¢å™¨
python retriever/simple_retriever.py
```

è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨ï¼š
- TF-IDFå‘é‡åŒ–
- ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—
- jiebaä¸­æ–‡åˆ†è¯
- scikit-learnåº“

#### æ­¥éª¤5ï¼šæµ‹è¯•æ£€ç´¢æ•ˆæœ
æ£€ç´¢å™¨ä¼šè‡ªåŠ¨æµ‹è¯•ä»¥ä¸‹æŸ¥è¯¢ï¼š
- "å¢¨å°”æœ¬æ€ä¹ˆåå…¬äº¤è½¦ï¼Ÿ"
- "å¦‚ä½•ä½¿ç”¨Mykiå¡ï¼Ÿ"
- "å­¦ç”Ÿä¹˜è½¦æœ‰ä¼˜æƒ å—ï¼Ÿ"
- "å¢¨å°”æœ¬çš„äº¤é€šå·¥å…·æœ‰å“ªäº›ï¼Ÿ"

### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰ˆæ£€ç´¢å™¨ï¼ˆå¯é€‰ï¼Œ2å°æ—¶ï¼‰

#### æ­¥éª¤6ï¼šBERTç‰ˆæœ¬æ£€ç´¢å™¨
å¦‚æœç¯å¢ƒå…è®¸ï¼Œå¯ä»¥è¿è¡ŒåŸºäºBERTçš„ç‰ˆæœ¬ï¼š
```bash
python retriever/retriever.py
```

è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨ï¼š
- bert-base-chineseæ¨¡å‹
- FAISSå‘é‡ç´¢å¼•
- æ›´é«˜ç²¾åº¦çš„è¯­ä¹‰ç†è§£

## ğŸ“Š æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. æ•°æ®é¢„å¤„ç†
```python
def preprocess_text(text):
    # å»é™¤ç‰¹æ®Šå­—ç¬¦
    # ä¸­æ–‡åˆ†è¯
    # è¿‡æ»¤åœç”¨è¯
    return processed_text
```

### 2. å‘é‡ç¼–ç 
```python
# TF-IDFæ–¹æ³•
vectorizer = TfidfVectorizer(max_features=5000, ngram_range=(1,2))
question_vectors = vectorizer.fit_transform(questions)

# æˆ–BERTæ–¹æ³•
model = AutoModel.from_pretrained('bert-base-chinese')
embeddings = model(inputs).last_hidden_state[:, 0, :]
```

### 3. ç›¸ä¼¼åº¦è®¡ç®—
```python
# ä½™å¼¦ç›¸ä¼¼åº¦
similarities = cosine_similarity(query_vector, question_vectors)

# æˆ–FAISSæ£€ç´¢
similarities, indices = faiss_index.search(query_embedding, k)
```

### 4. ç»“æœè¿”å›
```python
@dataclass
class RetrievalResult:
    question_id: str
    question: str
    answer: str
    similarity_score: float
```

## ğŸ¯ æ€§èƒ½æŒ‡æ ‡

### è¯„ä¼°æ ‡å‡†
1. **æ£€ç´¢é€Ÿåº¦**: < 1ç§’
2. **ç›¸å…³æ€§**: Top-3å‘½ä¸­ç‡ > 80%
3. **è¦†ç›–åº¦**: èƒ½æ‰¾åˆ°ç›¸å…³ç­”æ¡ˆçš„æŸ¥è¯¢æ¯”ä¾‹

### æµ‹è¯•ç”¨ä¾‹
åˆ›å»ºæµ‹è¯•é›†åŒ…å«ï¼š
- ç›´æ¥åŒ¹é…æŸ¥è¯¢ï¼ˆå¦‚"Mykiå¡"ï¼‰
- åŒä¹‰è¯æŸ¥è¯¢ï¼ˆå¦‚"å…¬äº¤å¡"vs"Mykiå¡"ï¼‰
- é•¿å¥æŸ¥è¯¢ï¼ˆå¦‚"æˆ‘æƒ³çŸ¥é“åœ¨å¢¨å°”æœ¬å¦‚ä½•ä¹˜åå…¬å…±äº¤é€š"ï¼‰

## ğŸ“ æ–‡ä»¶ç»“æ„

```
retriever/
â”œâ”€â”€ test_retriever.py          # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ simple_retriever.py        # TF-IDFç‰ˆæœ¬
â”œâ”€â”€ retriever.py              # BERTç‰ˆæœ¬
â”œâ”€â”€ tfidf_vectorizer.pkl      # ä¿å­˜çš„å‘é‡åŒ–å™¨
â”œâ”€â”€ question_vectors.pkl      # ä¿å­˜çš„é—®é¢˜å‘é‡
â”œâ”€â”€ id_mapping.json          # IDæ˜ å°„æ–‡ä»¶
â””â”€â”€ README.md                # è¯´æ˜æ–‡æ¡£
```

## ğŸ”§ è°ƒè¯•å’Œä¼˜åŒ–

### å¸¸è§é—®é¢˜
1. **åˆ†è¯æ•ˆæœå·®**: è°ƒæ•´jiebaåˆ†è¯ï¼Œæ·»åŠ è‡ªå®šä¹‰è¯å…¸
2. **æ£€ç´¢ä¸å‡†ç¡®**: è°ƒæ•´TF-IDFå‚æ•°ï¼Œå¢åŠ n-gram
3. **é€Ÿåº¦å¤ªæ…¢**: ä¼˜åŒ–å‘é‡ç»´åº¦ï¼Œä½¿ç”¨ç¨€ç–çŸ©é˜µ

### å‚æ•°è°ƒä¼˜
```python
# TF-IDFå‚æ•°
TfidfVectorizer(
    max_features=5000,     # ç‰¹å¾æ•°é‡
    ngram_range=(1, 2),    # n-gramèŒƒå›´
    min_df=1,              # æœ€å°æ–‡æ¡£é¢‘ç‡
    max_df=0.8             # æœ€å¤§æ–‡æ¡£é¢‘ç‡
)
```

## ğŸ“ˆ æ‰©å±•æ–¹å‘

### çŸ­æœŸä¼˜åŒ–
1. æ·»åŠ æŸ¥è¯¢æ‰©å±•ï¼ˆåŒä¹‰è¯ï¼‰
2. å®ç°æŸ¥è¯¢çº é”™
3. æ”¯æŒå¤šè½®å¯¹è¯

### é•¿æœŸè§„åˆ’
1. é›†æˆæ›´å¤§çš„é¢„è®­ç»ƒæ¨¡å‹
2. å®ç°æ··åˆæ£€ç´¢ï¼ˆç¨ å¯†+ç¨€ç–ï¼‰
3. æ·»åŠ é‡æ’åºæ¨¡å—

## âœ… éªŒæ”¶æ ‡å‡†

å®Œæˆä»¥ä¸‹ä»»åŠ¡å³å¯é€šè¿‡éªŒæ”¶ï¼š

1. âœ… æˆåŠŸåŠ è½½221æ¡é—®ç­”æ•°æ®
2. âœ… æ„å»ºé—®é¢˜å‘é‡ç´¢å¼•
3. âœ… å®ç°search(query, k)å‡½æ•°
4. âœ… è¿”å›RetrievalResultæ ¼å¼çš„ç»“æœ
5. âœ… æµ‹è¯•ç”¨ä¾‹é€šè¿‡ç‡ > 80%
6. âœ… å¹³å‡æ£€ç´¢æ—¶é—´ < 1ç§’
7. âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæœ‰æ³¨é‡Š
8. âœ… æä¾›ä½¿ç”¨ç¤ºä¾‹å’Œæµ‹è¯•è„šæœ¬

## ğŸš€ å¼€å§‹æ‰§è¡Œ

ç°åœ¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

1. **ç«‹å³æ‰§è¡Œ**: `python retriever/test_retriever.py`
2. **å®‰è£…ä¾èµ–**: `pip install jieba`
3. **æµ‹è¯•æ£€ç´¢**: `python retriever/simple_retriever.py`
4. **éªŒè¯ç»“æœ**: æ£€æŸ¥è¾“å‡ºçš„æ£€ç´¢ç»“æœæ˜¯å¦åˆç†
5. **ä¼˜åŒ–è°ƒæ•´**: æ ¹æ®ç»“æœè°ƒæ•´å‚æ•°
6. **æ–‡æ¡£å®Œå–„**: æ›´æ–°READMEå’Œæ³¨é‡Š

å¼€å§‹å§ï¼ğŸ¯
